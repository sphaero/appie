# Appie

[![Build Status](https://travis-ci.org/sphaero/appie.svg?branch=master)](https://travis-ci.org/sphaero/appie)

Appie is a simple static generator for dynamic websites. Dynamic websites? 
Yes! Appie's primary focus is on providing all information of files residing
in your website's directory. As from a HTML file you can not see what's available 
on your webserver Appie will provide a JSON file containing exactly this. 
From this the HTML file, using javascript, can figure things out. 
By matching to certain filenames the JSON file can be filled with 
specific data. For example a file with the .textile extension is parsed into HTML. 
Same holds for files ending with a .md (MarkDown) extension.

Just point Appie to a directory and it will provide you with a JSON file 
with all of its contents and a static directory with all static files.

By default Appie wil load files starting with '\_' into the JSON file.
Files generated by Appie can be served on very simple webhosting servers. 
No PHP or other webserver modules are needed! It is also possible to host 
on github.io for example (Don't forget the .nojekyll file)

Appie parses files through extensions. Extensions are very easy to 
write. If a file or directory is not matched to an extension it will be 
copied to the target build directory.

## Installation

Just use Pip:

    pip install https://github.com/sphaero/appie/archive/master.zip

*Appie is developed for Python3! It might work on Python2 but please move on! Unittest are also only testing Python>3.3.*

## Extensions

The following extensions are available:

- AppieFileParser (\_\*): by default any file starting with an '\_' will be loaded into the json as a string
- AppieTextileParser (\*.textile): html text entry in the resulting json file
- AppiePNGParser (\*.png): converted to a thumbnail jpg (filename_thumb.jpg) and a jpg with a fixed dimension (filename.jpg)
- AppieJPGParser (\*.jpg): converted to a thumbnail jpg (filename_thumb.jpg) and a jpg with a fixed dimension (filename.jpg) if the original image size is bigger than the set size

Some non default extensions:

- *.md.html: simple markdown file to html file parser matching on '.md.html' 
extensions. 
- blog/: a directory named blog will be parsed as a blog. Blog entries consist
of a markdown file (.md) containing metadata. The metadata and html content 
will be fed to the blog.jinja2 file which generates static html files. The 
json will contain all blog entries and metadata. See below for an example.

## Built-in webserver

For your development convenience Appie can also serve from the build directory. If you run appie with the -w flag it will serve the generated files through a HTTP server. By default this HTTP server runs on port 8000.

    $ appie -s /path/to/directory -w -p 8000
    Serving on port 8000...     press CTRL-C to quit

## Example

For example we have the following directory contents:

    ./files
    ./files/report_2008.pdf
    ./files/report_2009.pdf
    ./files/report_2010.pdf
    about.textile
    home.textile
    ./img/banner.png
    
Appie is run as follows:

    $ appie -s /path/to/directory

You will then have a new directory 'build' in your current direcyory with the following contents:

    ./build/files/report_2008.pdf
    ./build/files/report_2009.pdf
    ./build/files/report_2010.pdf
    ./build/img/banner_thumb.jpg
    ./build/img/banner_web.jpg
    ./build/img/banner.png
    ./build/all.json
    
The file 'all.json' will contain:

    { "home.textile" : {
        "content": "<h3>Test</h3><p>This is just a test</p>",
        "path": "",
        "mtime: "1481920145.5069501"
      },
      "about.textile" : {
        "content": <h3>About</h3><p>What about it</p>",
        "path": "",
        "mtime: "1481920145.5069501",
      },
      "files": {
        "report2010.pdf": {
          "path": "/files", 
          "mtime": "1481920145.5069501",
        },
        "report2009.pdf": {
          "path": "files",
          "mtime": "1481920145.5069501"
        }
      },
      "img" : {
        "banner.png": { 
            "thumb" : "banner_thumb.jpg", 
            "web": "banner.jpg", 
            "path": "img",
            "mtime": "1481920145.5069501",
            "mimetype": "image/png",
            "size": [400,300]
        }
      }
    }
    

## Blog example

For example we have the following directory contents:

    ./blog
    ./blog/blog.jinja2
    ./blog/first_post.md
    ./blog/img/first.jpg
    
When Appie is run with the BlogParser:

    $ appie -s /path/to/directory -d AppieBlogParser
    
You will end up with the following build directory:

    ./build/blog/first_post.html
    ./build/blog/img/first_thumb.jpg
    ./build/blog/img/first_web.jpg
    ./build/blog/img/first.jpg
    ./build/all.json

The all.json file will contain the following:

    {
        "blog": {
            "first_post.html": {
                "tags": [ "tag1", "tag2" ],
                "title" : ["First Post"],
                "summary" : ["A brief description of my document"],
                "date": ["2016-11-04"],
                "mtime": 0,
                "path": "blog",
                "content": '<h1 id="first-post">First Post</h1>\n'
                                        '<p>Hello world!</p>'
            },
            "img": {
                "first.jpg": { 
                    "thumb" : "first_thumb.jpg", 
                    "web": "first_web.jpg", 
                    "path": "blog/img",
                    ... etc
                }
            }
        }
    }

The blog.md file contains:

    title:   First Post
    summary: A brief description of my document.
    Date:    2016-11-04
    tags: tag1
          tag2

    First Post
    ##########
    
    Hello world!

It's important to understand all meta data is fed into the jinja2 template. Also note that the first_post.md file ends up in the json dictionary as first_post.html!

## Custom Parsers ##

Creating is a custom file parser is very simple. Just inherit the AppieFileParser class and implement a match() method which returns False or True on a filename. Then implement the parse_file() method which returns the dictionary with contents you want. As an example here's the AppieTextile class:

    class AppieTextileParser(AppieFileParser):

        def match(self, name):
            if name.endswith('.textile'):
                return True
    
        def parse_file(self, path, filename, dest_path):
            t = textile.textile(self.load_file(path))
            return { 'content': t }
    
Note that Appie expects the parser to return a dictionary with any content as the 'content' key. You can decide yourself if you want Appie to copy the original file or not by setting the self.copyfile boolean (default True) of your class.

To create a directory parser involves more work. You'll need to inherit the AppieDirParser class and implement the match() and parse_dir() methods. Have a look at the AppieBlogDirParser class to see an example.

## About ##

Appie originated at the [z25 Foundation](http://www.z25.org) where it is 
used to manage the main website. All content of the website is 
automatically updated through the subversion repositories of z25's 
projects by Appie. Appie is also used in production for 
[sphaero.org](http://www.sphaero.org)
